@import '../sass/_variables.sass'

$cell-padding: 8px
$cell-bg-color: rgba(#fff, .56)
$comment-bg-color: #666
$cell-border-color: rgba(#000, .1)
$active-cell-extrude-size: 4px

.cell
  display: block
  box-sizing: border-box
  padding: $data-cell-gutter
  flex: 1 0 $mobile-column-width
  transform: translate3d(0,0,0) // Push each cell to layer

  @media screen and (min-width: $grid-tablet-breakpoint)
    flex-basis: $tablet-column-width

  @media screen and (min-width: $grid-desktop-breakpoint)
    flex-basis: $desktop-column-width

.cellContent
  border-radius: 3px
  box-sizing: border-box
  border: 1px solid $cell-border-color

.cellContentHeader
  font-size: 18px
  background-color: #fff
  padding: $cell-padding*2 $cell-padding
  border-top-left-radius: 2px
  border-top-right-radius: 2px

.cellContentHeader:last-child
  border-bottom: 0
  margin-bottom: 0

$cropping-margin: 10px
.cellContentCropper
  overflow: hidden

  // Don't crop left & right side to edge,
  // which leaves space for active cell item & commentBlock's box-shadow.
  margin: 0 -$cropping-margin
  padding: 0 $cropping-margin

  // For tip indicator
  position: relative

.tip
  position: absolute
  margin-left: $cropping-margin + 2px // manually move left a bit
  background: unquote("rgb(#{$color-primary})")
  border-radius: 8px
  width: 8px
  height: 8px
  z-index: 2
  +shadow-2dp
  // border: 1px solid #fff

.upperTip
  bottom: -4px

.lowerTip
  top: -4px

.cellContentCropper:first-child
  margin-top: -$cropping-margin
  margin-bottom: $cropping-margin
  padding-top: $cropping-margin

.cellContentCropper:last-child
  margin-top: $cropping-margin
  margin-bottom: -$cropping-margin
  padding-bottom: $cropping-margin

.cellItem
  padding: $cell-padding
  border-top: 1px solid $cell-border-color
  background-color: $cell-bg-color
  will-change: background-color
  transition: background-color .1s
  cursor: pointer

  position: relative // For its "before" element

.cellItem:hover
  background-color: #fff

.cellItem:first-child
  border-top: 0

.cellItem
  &:before
    // Use before element to create hover-card effect.
    // Manipulates opacity, which is under hardware acceleration.
    //
    content: ''
    background: #fff

    opacity: 0
    will-change: opacity
    transition: opacity .2s
    border-radius: 2px
    +shadow-3dp
    z-index: -1 // Stacking context: cellItem
    position: absolute
    left: -$active-cell-extrude-size
    top: -$active-cell-extrude-size
    right: -$active-cell-extrude-size
    bottom: -$active-cell-extrude-size

    // Add some visual delimiter
    //
    border-top: 1px solid $table-bg

  &.isActive
    background-color: #fff
    z-index: 1 // Higher than other cellItems

  &.isActive:before
    opacity: 1

  &.hasNoRef
    color: #ccc
    text-decoration: line-through

.run
  // Default border-bottom
  &.hasUnidentifiedComment, &.RED_UNDERLINE, &.GREEN_UNDERLINE, &.YELLOW_UNDERLINE, &.DASHED_UNDERLINE, &.DOTTED_UNDERLINE
    border-bottom: 1px solid #ccc
  &.GREEN_UNDERLINE
    border-bottom-color: $green
  &.YELLOW_UNDERLINE
    border-bottom-color: $yellow
  &.RED_UNDERLINE
    border-bottom-color: $red
  &.DASHED_UNDERLINE
    border-bottom-style: dashed
  &.DOTTED_UNDERLINE
    border-bottom-style: dotted

  &.GREEN
    color: $green
  &.GRAY
    color: rgba(#000, .22)
  &.YELLOW
    color: $yellow
  &.RED
    color: $red

  &.QUESTION_INDICATOR:after, &.EXCLAMATION_INDICATOR:after, &.MORE_INDICATOR:after
    font-size: 12px
    font-weight: bold
    display: inline-block
    transform-origin: left top
    transform: translateY(-1px) scale(.8)
    font-style: italic

  &.QUESTION_INDICATOR:after
    content: '[ ? ]'
  &.EXCLAMATION_INDICATOR:after
    content: '[ ! ]'
  &.MORE_INDICATOR:after
    content: '[â‹¯]'


.reference
  $margin: $active-cell-extrude-size + $cell-padding
  margin: $margin (-$margin) (-$margin) (-$margin)
  border-top: 1px solid $table-bg
  padding: ($margin - 1) $margin $margin ($margin + 24px)

  // For the book icon
  position: relative

  &:before
    content: 'launch'
    +material-icon-font
    font-size: 16px
    color: rgba(#000, .56)

    position: absolute
    left: $margin
    top: $margin

.commentBlock
  padding: $active-cell-extrude-size + $cell-padding 0
  margin: 0 (-$active-cell-extrude-size)
  background: $comment-bg-color
  color: rgba(#fff, .8)
  +shadow-3dp
  will-change: height
  animation: expand .3s ease-out

.comment
  padding: 8px ($active-cell-extrude-size + $cell-padding) 0
  margin-top: 4px
  border-top: 1px solid $cell-bg-color

  header
    display: flex
    margin-bottom: 4px

  footer
    font-size: 12px
    color: rgba(#fff, .12)

.comment:first-child
  border-top: 0
  margin-top: 0
  padding-top: 0

.commentType
  font-size: 12px
  line-height: 1
  padding: 4px 8px
  background: #999
  color: #fff
  margin-right: auto
  border-radius: 2px

  &.GREEN_UNDERLINE, &.GREEN
    background: $green
  &.YELLOW_UNDERLINE, &.YELLOW
    background: $yellow
  &.RED_UNDERLINE, &.RED
    background: $red

.commentAuthor
  color: rgba(#fff, .56)
  font-size: 13px

@keyframes expand
  0%
    height: 0